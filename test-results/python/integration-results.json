{"created": 1772292433.3536553, "duration": 1.2914905548095703, "exitcode": 0, "root": "/home/runner/work/tony_tesla/tony_tesla", "environment": {}, "summary": {"passed": 12, "total": 12, "collected": 12}, "collectors": [{"nodeid": "", "outcome": "passed", "result": [{"nodeid": "tests/integration", "type": "Package"}]}, {"nodeid": "tests/integration/test_tony_server.py::TestClient", "outcome": "passed", "result": []}, {"nodeid": "tests/integration/test_tony_server.py", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_tony_server.py::TestClient", "type": "Class"}, {"nodeid": "tests/integration/test_tony_server.py::test_search_function", "type": "Function", "lineno": 62}, {"nodeid": "tests/integration/test_tony_server.py::test_parse_tool_call", "type": "Function", "lineno": 119}, {"nodeid": "tests/integration/test_tony_server.py::test_make_vapi_response", "type": "Function", "lineno": 128}, {"nodeid": "tests/integration/test_tony_server.py::test_vapi_assistant_call_input", "type": "Function", "lineno": 144}, {"nodeid": "tests/integration/test_tony_server.py::test_vapi_assistant_call_input_non_igor", "type": "Function", "lineno": 210}, {"nodeid": "tests/integration/test_tony_server.py::test_is_igor_caller", "type": "Function", "lineno": 276}, {"nodeid": "tests/integration/test_tony_server.py::test_get_caller_number", "type": "Function", "lineno": 297}, {"nodeid": "tests/integration/test_tony_server.py::test_apply_caller_restrictions", "type": "Function", "lineno": 327}, {"nodeid": "tests/integration/test_tony_server.py::test_assistant_endpoint_logs_failure", "type": "Function", "lineno": 375}, {"nodeid": "tests/integration/test_tony_server.py::test_send_text_integration", "type": "Coroutine", "lineno": 414}, {"nodeid": "tests/integration/test_tony_server.py::test_cors_headers", "type": "Function", "lineno": 507}, {"nodeid": "tests/integration/test_tony_server.py::test_send_text_ifttt_integration", "type": "Coroutine", "lineno": 537}]}, {"nodeid": "tests/integration", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_tony_server.py", "type": "Module"}]}], "tests": [{"nodeid": "tests/integration/test_tony_server.py::test_search_function", "lineno": 62, "outcome": "passed", "keywords": ["test_search_function", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.001392046999995955, "outcome": "passed"}, "call": {"duration": 0.14503762000001075, "outcome": "passed", "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '173', 'content-type': 'application/json'}\nauth_line: Bearer test_pplx_key\npayload: {'model': 'sonar-pro', 'messages': [{'role': 'system', 'content': 'Be precise and concise.'}, {'role': 'user', 'content': 'What is the weather in Seattle?'}]}\nheaders: {'accept': 'application/json', 'content-type': 'application/json', 'authorization': 'Bearer test_pplx_key'}\nsearch_response.json(): {'id': '2fb30930-796a-405d-be66-12fa7f54db75', 'model': 'sonar-pro', 'created': 1742044995, 'usage': {'prompt_tokens': 12, 'completion_tokens': 356, 'total_tokens': 368}, 'object': 'chat.completion', 'choices': [{'index': 0, 'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': 'The weather in Seattle is currently chilly with intervals of clouds and sun.'}}]}\nvapi_response: {'results': [{'toolCallId': 'toolu_01FDyjjUG1ig7hP9YQ6MQXhX', 'result': 'The weather in Seattle is currently chilly with intervals of clouds and sun.'}]}\n"}, "teardown": {"duration": 0.0008631139999977222, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_parse_tool_call", "lineno": 119, "outcome": "passed", "keywords": ["test_parse_tool_call", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.000631373000004487, "outcome": "passed"}, "call": {"duration": 0.00026531299999987823, "outcome": "passed"}, "teardown": {"duration": 0.0007877350000029537, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_make_vapi_response", "lineno": 128, "outcome": "passed", "keywords": ["test_make_vapi_response", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0005127930000128345, "outcome": "passed"}, "call": {"duration": 0.00018567499999733172, "outcome": "passed"}, "teardown": {"duration": 0.0007049100000102726, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_vapi_assistant_call_input", "lineno": 144, "outcome": "passed", "keywords": ["test_vapi_assistant_call_input", "usefixtures", "pytestmark", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0007399749999876803, "outcome": "passed"}, "call": {"duration": 0.17507386799999836, "outcome": "passed", "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '603', 'content-type': 'application/json'}\ninput: {'message': {'timestamp': 1736039875874, 'type': 'assistant-request', 'call': {'id': 'xxx-xxx', 'orgId': 'xxx-xxx', 'createdAt': '2025-01-05T01:17:55.739Z', 'updatedAt': '2025-01-05T01:17:55.739Z', 'type': 'inbound Phone Call', 'status': 'ringing', 'phoneCallProvider': 'twilio', 'phoneCallProviderId': 'xxx-xxx', 'phoneCallTransport': 'pstn', 'phoneNumberId': 'xxx-xxx', 'assistantId': None, 'squadId': None, 'customer': {'number': '+1xxx-xxx', 'phoneNumber': {'id': 'xxx-xxx', 'orgId': 'xxx-xxx', 'assistantId': None, 'number': '+1xxx-xxx', 'createdAt': '2024-04-12T16:35:14.400Z', 'updatedAt': '2024-11-27T17:14:08.833Z', 'provider': 'twilio'}}}}}\nlen(tony): 1\n"}, "teardown": {"duration": 0.0009883860000030609, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_vapi_assistant_call_input_non_igor", "lineno": 210, "outcome": "passed", "keywords": ["test_vapi_assistant_call_input_non_igor", "usefixtures", "pytestmark", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0007959689999950115, "outcome": "passed"}, "call": {"duration": 0.02709132399999703, "outcome": "passed", "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '606', 'content-type': 'application/json'}\ninput: {'message': {'timestamp': 1736039875874, 'type': 'assistant-request', 'call': {'id': 'xxx-xxx', 'orgId': 'xxx-xxx', 'createdAt': '2025-01-05T01:17:55.739Z', 'updatedAt': '2025-01-05T01:17:55.739Z', 'type': 'inbound Phone Call', 'status': 'ringing', 'phoneCallProvider': 'twilio', 'phoneCallProviderId': 'xxx-xxx', 'phoneCallTransport': 'pstn', 'phoneNumberId': 'xxx-xxx', 'assistantId': None, 'squadId': None, 'customer': {'number': '+11234567890', 'phoneNumber': {'id': 'xxx-xxx', 'orgId': 'xxx-xxx', 'assistantId': None, 'number': '+1xxx-xxx', 'createdAt': '2024-04-12T16:35:14.400Z', 'updatedAt': '2024-11-27T17:14:08.833Z', 'provider': 'twilio'}}}}}\nlen(tony): 1\n"}, "teardown": {"duration": 0.000757297000006929, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_is_igor_caller", "lineno": 276, "outcome": "passed", "keywords": ["test_is_igor_caller", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.00041065300000298066, "outcome": "passed"}, "call": {"duration": 0.0008622219999949721, "outcome": "passed", "stdout": "Missing 'call' key\n"}, "teardown": {"duration": 0.0007003809999872601, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_get_caller_number", "lineno": 297, "outcome": "passed", "keywords": ["test_get_caller_number", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0004371219999939058, "outcome": "passed"}, "call": {"duration": 0.0013798150000070564, "outcome": "passed", "stdout": "Missing 'number' key\nMissing 'customer' key\nMissing 'call' key\nMissing 'message' key\nMissing 'message' key\nInput is None\n"}, "teardown": {"duration": 0.0007234549999992623, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_apply_caller_restrictions", "lineno": 327, "outcome": "passed", "keywords": ["test_apply_caller_restrictions", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0005676840000035099, "outcome": "passed"}, "call": {"duration": 0.0003572640000015781, "outcome": "passed"}, "teardown": {"duration": 0.000714998000006517, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_assistant_endpoint_logs_failure", "lineno": 375, "outcome": "passed", "keywords": ["test_assistant_endpoint_logs_failure", "usefixtures", "pytestmark", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.000594605000003412, "outcome": "passed"}, "call": {"duration": 0.02770584099999951, "outcome": "passed", "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '398', 'content-type': 'application/json'}\ninput: {'message': {'timestamp': 1737157773126, 'type': 'status-update', 'status': 'ended', 'endedReason': 'assistant-request-returned-invalid-assistant', 'inboundPhoneCallDebuggingArtifacts': {'error': \"Couldn't Get Assistant...\", 'assistantRequestError': 'Invalid Assistant. Errors: [\\n  \"assistant.model.All fallbackModels\\'s elements must be unique\"\\n]', 'assistantRequestResponse': {'assistant': {'name': 'Tony'}}}}}\nfailure_reason: Invalid Assistant. Errors: [\n                  \"assistant.model.All fallbackModels's elements must be unique\"\n                ]\nMissing 'call' key\nMissing 'call' key\nlen(tony): 1\n"}, "teardown": {"duration": 0.0008024819999974397, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_send_text_integration", "lineno": 414, "outcome": "passed", "keywords": ["test_send_text_integration", "asyncio", "pytestmark", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0008396610000005467, "outcome": "passed"}, "call": {"duration": 0.011638879000003044, "outcome": "passed", "stdout": "Twilio environment check:\nTWILIO_ACCOUNT_SID exists:, TWILIO_ACCOUNT_SID in os.environ: True\nTWILIO_AUTH_TOKEN exists:, TWILIO_AUTH_TOKEN in os.environ: True\nTWILIO_FROM_NUMBER exists:, TWILIO_FROM_NUMBER in os.environ: True\n\"TWILIO_FROM_NUMBER value:\": TWILIO_FROM_NUMBER value:\nos.environ.get(TWILIO_FROM_NUMBER): +13203734339\nSending message with params:\nTo:, to_number: +12068904339\nFrom:, os.environ[TWILIO_FROM_NUMBER]: +13203734339\nText:, text: Hello, this is a test message\n\"Twilio response:\": Twilio response:\nmessage.__dict__: {'_mock_return_value': sentinel.DEFAULT, '_mock_parent': None, '_mock_name': None, '_mock_new_name': '()', '_mock_new_parent': <Mock name='Client().messages.create' id='140399933012496'>, '_mock_sealed': False, '_spec_class': None, '_spec_set': None, '_spec_signature': None, '_mock_methods': None, '_spec_asyncs': [], '_mock_children': {}, '_mock_wraps': None, '_mock_delegate': None, '_mock_called': False, '_mock_call_args': None, '_mock_call_count': 0, '_mock_call_args_list': [], '_mock_mock_calls': [], 'method_calls': [], '_mock_unsafe': False, '_mock_side_effect': None, 'sid': 'SM12345'}\nTwilio environment check:\nTWILIO_ACCOUNT_SID exists:, TWILIO_ACCOUNT_SID in os.environ: True\nTWILIO_AUTH_TOKEN exists:, TWILIO_AUTH_TOKEN in os.environ: True\nTWILIO_FROM_NUMBER exists:, TWILIO_FROM_NUMBER in os.environ: True\n\"TWILIO_FROM_NUMBER value:\": TWILIO_FROM_NUMBER value:\nos.environ.get(TWILIO_FROM_NUMBER): +13203734339\nerror_msg: Unexpected error: Connection error\n"}, "teardown": {"duration": 0.0010501719999922443, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_cors_headers", "lineno": 507, "outcome": "passed", "keywords": ["test_cors_headers", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0007611440000090397, "outcome": "passed"}, "call": {"duration": 0.02708550200000559, "outcome": "passed", "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'origin': 'https://idvork.in', 'content-length': '40', 'content-type': 'application/json'}\ninput: {'message': {'type': 'assistant-request'}}\nMissing 'call' key\nMissing 'call' key\nlen(tony): 1\n"}, "teardown": {"duration": 0.0007585190000014563, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_send_text_ifttt_integration", "lineno": 537, "outcome": "passed", "keywords": ["test_send_text_ifttt_integration", "asyncio", "pytestmark", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0007077350000059823, "outcome": "passed"}, "call": {"duration": 0.16522946999999988, "outcome": "passed", "stdout": "IFTTT environment check:\nIFTTT_WEBHOOK_KEY exists:, IFTTT_WEBHOOK_KEY in os.environ: True\n\"IFTTT_WEBHOOK_SMS_EVENT exists:\": IFTTT_WEBHOOK_SMS_EVENT exists:\nIFTTT_WEBHOOK_SMS_EVENT in os.environ: True\nSending IFTTT webhook request:\n\"URL:\": URL:\nifttt_url: https://maker.ifttt.com/trigger/test_event/with/key/test_key\n\"Payload:\": Payload:\npayload: {'value1': 'Hello, this is a test message', 'value2': '+12068904339', 'value3': 'From Tony Tesla at 2026-02-28 07:27:13'}\nIFTTT response status:, response.status_code: 200\n\"IFTTT response text:\": IFTTT response text:\nresponse.text: Congratulations! You've fired the sms_event event\nIFTTT environment check:\nIFTTT_WEBHOOK_KEY exists:, IFTTT_WEBHOOK_KEY in os.environ: True\n\"IFTTT_WEBHOOK_SMS_EVENT exists:\": IFTTT_WEBHOOK_SMS_EVENT exists:\nIFTTT_WEBHOOK_SMS_EVENT in os.environ: True\nSending IFTTT webhook request:\n\"URL:\": URL:\nifttt_url: https://maker.ifttt.com/trigger/test_event/with/key/test_key\n\"Payload:\": Payload:\npayload: {'value1': 'Hello, this is a test message', 'value2': '+12068904339', 'value3': 'From Tony Tesla at 2026-02-28 07:27:13'}\nerror_msg: Failed to send webhook request: Connection failed\nIFTTT environment check:\nIFTTT_WEBHOOK_KEY exists:, IFTTT_WEBHOOK_KEY in os.environ: True\n\"IFTTT_WEBHOOK_SMS_EVENT exists:\": IFTTT_WEBHOOK_SMS_EVENT exists:\nIFTTT_WEBHOOK_SMS_EVENT in os.environ: True\nSending IFTTT webhook request:\nURL:, ifttt_url: https://maker.ifttt.com/trigger/test_event/with/key/\n\"Payload:\": Payload:\npayload: {'value1': 'Hello, this is a test message', 'value2': '+12068904339', 'value3': 'From Tony Tesla at 2026-02-28 07:27:13'}\nerror_msg: Failed to send webhook request: 404 Client Error: Not Found for url: https://maker.ifttt.com/trigger/test_event/with/key/\n"}, "teardown": {"duration": 0.0010125619999996616, "outcome": "passed"}}], "warnings": [{"message": "coroutine 'AsyncClient.post' was never awaited", "category": "RuntimeWarning", "when": "runtest", "filename": "/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/ast.py", "lineno": 86}, {"message": "coroutine 'AsyncClient.post' was never awaited", "category": "RuntimeWarning", "when": "runtest", "filename": "/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/site-packages/icecream/icecream.py", "lineno": 341}]}