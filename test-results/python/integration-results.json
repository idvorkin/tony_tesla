{"created": 1742044699.8295212, "duration": 3.6275687217712402, "exitcode": 1, "root": "/home/runner/work/tony_tesla/tony_tesla", "environment": {}, "summary": {"failed": 9, "passed": 8, "total": 17, "collected": 17}, "collectors": [{"nodeid": "", "outcome": "passed", "result": [{"nodeid": "tests/integration", "type": "Package"}]}, {"nodeid": "tests/integration/test_blog_handler.py::TestClient", "outcome": "passed", "result": []}, {"nodeid": "tests/integration/test_blog_handler.py", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_blog_handler.py::TestClient", "type": "Class"}, {"nodeid": "tests/integration/test_blog_handler.py::test_random_blog", "type": "Function", "lineno": 22}, {"nodeid": "tests/integration/test_blog_handler.py::test_blog_info", "type": "Function", "lineno": 39}, {"nodeid": "tests/integration/test_blog_handler.py::test_read_blog_post", "type": "Function", "lineno": 63}, {"nodeid": "tests/integration/test_blog_handler.py::test_random_blog_url", "type": "Function", "lineno": 101}, {"nodeid": "tests/integration/test_blog_handler.py::test_blog_search", "type": "Function", "lineno": 117}]}, {"nodeid": "tests/integration/test_tony_server.py::TestClient", "outcome": "passed", "result": []}, {"nodeid": "tests/integration/test_tony_server.py", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_tony_server.py::TestClient", "type": "Class"}, {"nodeid": "tests/integration/test_tony_server.py::test_search_function", "type": "Function", "lineno": 60}, {"nodeid": "tests/integration/test_tony_server.py::test_parse_tool_call", "type": "Function", "lineno": 81}, {"nodeid": "tests/integration/test_tony_server.py::test_make_vapi_response", "type": "Function", "lineno": 90}, {"nodeid": "tests/integration/test_tony_server.py::test_blog_search", "type": "Function", "lineno": 104}, {"nodeid": "tests/integration/test_tony_server.py::test_vapi_assistant_call_input", "type": "Function", "lineno": 150}, {"nodeid": "tests/integration/test_tony_server.py::test_vapi_assistant_call_input_non_igor", "type": "Function", "lineno": 216}, {"nodeid": "tests/integration/test_tony_server.py::test_is_igor_caller", "type": "Function", "lineno": 282}, {"nodeid": "tests/integration/test_tony_server.py::test_get_caller_number", "type": "Function", "lineno": 297}, {"nodeid": "tests/integration/test_tony_server.py::test_apply_caller_restrictions", "type": "Function", "lineno": 327}, {"nodeid": "tests/integration/test_tony_server.py::test_assistant_endpoint_logs_failure", "type": "Function", "lineno": 376}, {"nodeid": "tests/integration/test_tony_server.py::test_send_text_integration", "type": "Coroutine", "lineno": 415}, {"nodeid": "tests/integration/test_tony_server.py::test_send_text_ifttt_integration", "type": "Coroutine", "lineno": 485}]}, {"nodeid": "tests/integration", "outcome": "passed", "result": [{"nodeid": "tests/integration/test_blog_handler.py", "type": "Module"}, {"nodeid": "tests/integration/test_tony_server.py", "type": "Module"}]}], "tests": [{"nodeid": "tests/integration/test_blog_handler.py::test_random_blog", "lineno": 22, "outcome": "failed", "keywords": ["test_random_blog", "test_blog_handler.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.000726368999977467, "outcome": "passed"}, "call": {"duration": 0.19333245600000737, "outcome": "failed", "crash": {"path": "<frozen os>", "lineno": 714, "message": "KeyError: 'TONY_API_KEY'"}, "traceback": [{"path": "tests/integration/test_blog_handler.py", "lineno": 26, "message": "in test_random_blog"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 538, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1144, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 437, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 825, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 914, "message": "in send"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 942, "message": "in _send_handling_auth"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 979, "message": "in _send_handling_redirects"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1014, "message": "in _send_single_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 340, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 337, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 290, "message": "in call"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 456, "message": "in result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 401, "message": "in __get_result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 221, "message": "in _call_func"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py", "lineno": 1054, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py", "lineno": 112, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 187, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 165, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 62, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 714, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 734, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 288, "message": "in handle"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 76, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 73, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 301, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 212, "message": "in run_endpoint_function"}, {"path": "blog_server.py", "lineno": 83, "message": "in random_blog_endpoint"}, {"path": "tony_server.py", "lineno": 108, "message": "in raise_if_not_authorized"}, {"path": "<frozen os>", "lineno": 714, "message": "in __getitem__"}], "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '2', 'content-type': 'application/json'}\nf\"Error in random_blog: {str(e)}\": Error in random_blog: 'TONY_API_KEY'\n", "longrepr": "tests/integration/test_blog_handler.py:26: in test_random_blog\n    response = client.post(\"/random_blog\", json={}, headers=auth_headers)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:538: in post\n    return super().post(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1144: in post\n    return self.request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:437: in request\n    return super().request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request\n    response = transport.handle_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:340: in handle_request\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:337: in handle_request\n    portal.call(self.app, scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py:112: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:187: in __call__\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:165: in __call__\n    await self.app(scope, receive, _send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:714: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:734: in app\n    await route.handle(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:288: in handle\n    await self.app(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:76: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:73: in app\n    response = await f(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:301: in app\n    raw_response = await run_endpoint_function(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:212: in run_endpoint_function\n    return await dependant.call(**values)\nblog_server.py:83: in random_blog_endpoint\n    raise_if_not_authorized(headers)\ntony_server.py:108: in raise_if_not_authorized\n    if token != os.environ[TONY_API_KEY_NAME]:\n<frozen os>:714: in __getitem__\n    ???\nE   KeyError: 'TONY_API_KEY'"}, "teardown": {"duration": 0.0002732869999988452, "outcome": "passed"}}, {"nodeid": "tests/integration/test_blog_handler.py::test_blog_info", "lineno": 39, "outcome": "failed", "keywords": ["test_blog_info", "test_blog_handler.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.000306558999994877, "outcome": "passed"}, "call": {"duration": 0.003642475999981798, "outcome": "failed", "crash": {"path": "<frozen os>", "lineno": 714, "message": "KeyError: 'TONY_API_KEY'"}, "traceback": [{"path": "tests/integration/test_blog_handler.py", "lineno": 43, "message": "in test_blog_info"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 538, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1144, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 437, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 825, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 914, "message": "in send"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 942, "message": "in _send_handling_auth"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 979, "message": "in _send_handling_redirects"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1014, "message": "in _send_single_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 340, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 337, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 290, "message": "in call"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 456, "message": "in result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 401, "message": "in __get_result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 221, "message": "in _call_func"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py", "lineno": 1054, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py", "lineno": 112, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 187, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 165, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 62, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 714, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 734, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 288, "message": "in handle"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 76, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 73, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 301, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 212, "message": "in run_endpoint_function"}, {"path": "blog_server.py", "lineno": 112, "message": "in blog_info_endpoint"}, {"path": "tony_server.py", "lineno": 108, "message": "in raise_if_not_authorized"}, {"path": "<frozen os>", "lineno": 714, "message": "in __getitem__"}], "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '2', 'content-type': 'application/json'}\nf\"Error in blog_info: {str(e)}\": Error in blog_info: 'TONY_API_KEY'\n", "longrepr": "tests/integration/test_blog_handler.py:43: in test_blog_info\n    response = client.post(\"/blog_info\", json={}, headers=auth_headers)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:538: in post\n    return super().post(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1144: in post\n    return self.request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:437: in request\n    return super().request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request\n    response = transport.handle_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:340: in handle_request\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:337: in handle_request\n    portal.call(self.app, scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py:112: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:187: in __call__\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:165: in __call__\n    await self.app(scope, receive, _send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:714: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:734: in app\n    await route.handle(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:288: in handle\n    await self.app(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:76: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:73: in app\n    response = await f(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:301: in app\n    raw_response = await run_endpoint_function(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:212: in run_endpoint_function\n    return await dependant.call(**values)\nblog_server.py:112: in blog_info_endpoint\n    raise_if_not_authorized(headers)\ntony_server.py:108: in raise_if_not_authorized\n    if token != os.environ[TONY_API_KEY_NAME]:\n<frozen os>:714: in __getitem__\n    ???\nE   KeyError: 'TONY_API_KEY'"}, "teardown": {"duration": 0.00024921199999994315, "outcome": "passed"}}, {"nodeid": "tests/integration/test_blog_handler.py::test_read_blog_post", "lineno": 63, "outcome": "failed", "keywords": ["test_read_blog_post", "test_blog_handler.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.000321215999974811, "outcome": "passed"}, "call": {"duration": 0.0036801250000166874, "outcome": "failed", "crash": {"path": "<frozen os>", "lineno": 714, "message": "KeyError: 'TONY_API_KEY'"}, "traceback": [{"path": "tests/integration/test_blog_handler.py", "lineno": 70, "message": "in test_read_blog_post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 538, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1144, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 437, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 825, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 914, "message": "in send"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 942, "message": "in _send_handling_auth"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 979, "message": "in _send_handling_redirects"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1014, "message": "in _send_single_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 340, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 337, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 290, "message": "in call"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 456, "message": "in result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 401, "message": "in __get_result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 221, "message": "in _call_func"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py", "lineno": 1054, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py", "lineno": 112, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 187, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 165, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 62, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 714, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 734, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 288, "message": "in handle"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 76, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 73, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 301, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 212, "message": "in run_endpoint_function"}, {"path": "blog_server.py", "lineno": 140, "message": "in read_blog_post_endpoint"}, {"path": "tony_server.py", "lineno": 108, "message": "in raise_if_not_authorized"}, {"path": "<frozen os>", "lineno": 714, "message": "in __getitem__"}], "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '25', 'content-type': 'application/json'}\nf\"Error in read_blog_post: {str(e)}\": Error in read_blog_post: 'TONY_API_KEY'\n", "longrepr": "tests/integration/test_blog_handler.py:70: in test_read_blog_post\n    response = client.post(\"/read_blog_post\", json=params, headers=auth_headers)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:538: in post\n    return super().post(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1144: in post\n    return self.request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:437: in request\n    return super().request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request\n    response = transport.handle_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:340: in handle_request\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:337: in handle_request\n    portal.call(self.app, scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py:112: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:187: in __call__\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:165: in __call__\n    await self.app(scope, receive, _send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:714: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:734: in app\n    await route.handle(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:288: in handle\n    await self.app(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:76: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:73: in app\n    response = await f(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:301: in app\n    raw_response = await run_endpoint_function(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:212: in run_endpoint_function\n    return await dependant.call(**values)\nblog_server.py:140: in read_blog_post_endpoint\n    raise_if_not_authorized(headers)\ntony_server.py:108: in raise_if_not_authorized\n    if token != os.environ[TONY_API_KEY_NAME]:\n<frozen os>:714: in __getitem__\n    ???\nE   KeyError: 'TONY_API_KEY'"}, "teardown": {"duration": 0.00026151599999479913, "outcome": "passed"}}, {"nodeid": "tests/integration/test_blog_handler.py::test_random_blog_url", "lineno": 101, "outcome": "failed", "keywords": ["test_random_blog_url", "test_blog_handler.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0003323369999748138, "outcome": "passed"}, "call": {"duration": 0.0034497879999833003, "outcome": "failed", "crash": {"path": "<frozen os>", "lineno": 714, "message": "KeyError: 'TONY_API_KEY'"}, "traceback": [{"path": "tests/integration/test_blog_handler.py", "lineno": 105, "message": "in test_random_blog_url"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 538, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1144, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 437, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 825, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 914, "message": "in send"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 942, "message": "in _send_handling_auth"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 979, "message": "in _send_handling_redirects"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1014, "message": "in _send_single_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 340, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 337, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 290, "message": "in call"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 456, "message": "in result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 401, "message": "in __get_result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 221, "message": "in _call_func"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py", "lineno": 1054, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py", "lineno": 112, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 187, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 165, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 62, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 714, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 734, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 288, "message": "in handle"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 76, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 73, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 301, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 212, "message": "in run_endpoint_function"}, {"path": "blog_server.py", "lineno": 175, "message": "in random_blog_url_endpoint"}, {"path": "tony_server.py", "lineno": 108, "message": "in raise_if_not_authorized"}, {"path": "<frozen os>", "lineno": 714, "message": "in __getitem__"}], "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '2', 'content-type': 'application/json'}\nf\"Error in random_blog_url: {str(e)}\": Error in random_blog_url: 'TONY_API_KEY'\n", "longrepr": "tests/integration/test_blog_handler.py:105: in test_random_blog_url\n    response = client.post(\"/random_blog_url\", json={}, headers=auth_headers)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:538: in post\n    return super().post(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1144: in post\n    return self.request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:437: in request\n    return super().request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request\n    response = transport.handle_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:340: in handle_request\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:337: in handle_request\n    portal.call(self.app, scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py:112: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:187: in __call__\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:165: in __call__\n    await self.app(scope, receive, _send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:714: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:734: in app\n    await route.handle(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:288: in handle\n    await self.app(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:76: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:73: in app\n    response = await f(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:301: in app\n    raw_response = await run_endpoint_function(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:212: in run_endpoint_function\n    return await dependant.call(**values)\nblog_server.py:175: in random_blog_url_endpoint\n    raise_if_not_authorized(headers)\ntony_server.py:108: in raise_if_not_authorized\n    if token != os.environ[TONY_API_KEY_NAME]:\n<frozen os>:714: in __getitem__\n    ???\nE   KeyError: 'TONY_API_KEY'"}, "teardown": {"duration": 0.00025431299999922885, "outcome": "passed"}}, {"nodeid": "tests/integration/test_blog_handler.py::test_blog_search", "lineno": 117, "outcome": "failed", "keywords": ["test_blog_search", "test_blog_handler.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0003359140000043226, "outcome": "passed"}, "call": {"duration": 0.23062151000002018, "outcome": "failed", "crash": {"path": "<frozen os>", "lineno": 714, "message": "KeyError: 'TONY_API_KEY'"}, "traceback": [{"path": "tests/integration/test_blog_handler.py", "lineno": 144, "message": "in test_blog_search"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 538, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1144, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 437, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 825, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 914, "message": "in send"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 942, "message": "in _send_handling_auth"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 979, "message": "in _send_handling_redirects"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1014, "message": "in _send_single_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 340, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 337, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 290, "message": "in call"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 456, "message": "in result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 401, "message": "in __get_result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 221, "message": "in _call_func"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py", "lineno": 1054, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py", "lineno": 112, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 187, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 165, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 62, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 714, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 734, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 288, "message": "in handle"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 76, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 73, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 301, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 212, "message": "in run_endpoint_function"}, {"path": "blog_server.py", "lineno": 200, "message": "in blog_search_endpoint"}, {"path": "tony_server.py", "lineno": 108, "message": "in raise_if_not_authorized"}, {"path": "<frozen os>", "lineno": 714, "message": "in __getitem__"}], "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '22', 'content-type': 'application/json'}\nf\"Error in blog_search: {str(e)}\": Error in blog_search: 'TONY_API_KEY'\n", "longrepr": "tests/integration/test_blog_handler.py:144: in test_blog_search\n    response = client.post(\"/blog_search\", json=params, headers=auth_headers)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:538: in post\n    return super().post(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1144: in post\n    return self.request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:437: in request\n    return super().request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request\n    response = transport.handle_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:340: in handle_request\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:337: in handle_request\n    portal.call(self.app, scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py:112: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:187: in __call__\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:165: in __call__\n    await self.app(scope, receive, _send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:714: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:734: in app\n    await route.handle(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:288: in handle\n    await self.app(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:76: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:73: in app\n    response = await f(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:301: in app\n    raw_response = await run_endpoint_function(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:212: in run_endpoint_function\n    return await dependant.call(**values)\nblog_server.py:200: in blog_search_endpoint\n    raise_if_not_authorized(headers)\ntony_server.py:108: in raise_if_not_authorized\n    if token != os.environ[TONY_API_KEY_NAME]:\n<frozen os>:714: in __getitem__\n    ???\nE   KeyError: 'TONY_API_KEY'"}, "teardown": {"duration": 0.00025223800000162555, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_search_function", "lineno": 60, "outcome": "failed", "keywords": ["test_search_function", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0003571629999896686, "outcome": "passed"}, "call": {"duration": 0.002551758999999265, "outcome": "failed", "crash": {"path": "<frozen os>", "lineno": 714, "message": "KeyError: 'TONY_API_KEY'"}, "traceback": [{"path": "tests/integration/test_tony_server.py", "lineno": 64, "message": "in test_search_function"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 538, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1144, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 437, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 825, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 914, "message": "in send"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 942, "message": "in _send_handling_auth"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 979, "message": "in _send_handling_redirects"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1014, "message": "in _send_single_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 340, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 337, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 290, "message": "in call"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 456, "message": "in result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 401, "message": "in __get_result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 221, "message": "in _call_func"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py", "lineno": 1054, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py", "lineno": 112, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 187, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 165, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 62, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 714, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 734, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 288, "message": "in handle"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 76, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 73, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 301, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 212, "message": "in run_endpoint_function"}, {"path": "tony_server.py", "lineno": 359, "message": "in search_endpoint"}, {"path": "tony_server.py", "lineno": 122, "message": "in search_logic"}, {"path": "tony_server.py", "lineno": 108, "message": "in raise_if_not_authorized"}, {"path": "<frozen os>", "lineno": 714, "message": "in __getitem__"}], "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '173', 'content-type': 'application/json'}\n", "longrepr": "tests/integration/test_tony_server.py:64: in test_search_function\n    response = client.post(\"/search\", json=base_params, headers=auth_headers)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:538: in post\n    return super().post(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1144: in post\n    return self.request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:437: in request\n    return super().request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request\n    response = transport.handle_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:340: in handle_request\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:337: in handle_request\n    portal.call(self.app, scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py:112: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:187: in __call__\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:165: in __call__\n    await self.app(scope, receive, _send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:714: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:734: in app\n    await route.handle(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:288: in handle\n    await self.app(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:76: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:73: in app\n    response = await f(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:301: in app\n    raw_response = await run_endpoint_function(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:212: in run_endpoint_function\n    return await dependant.call(**values)\ntony_server.py:359: in search_endpoint\n    return search_logic(params, headers)\ntony_server.py:122: in search_logic\n    raise_if_not_authorized(headers)\ntony_server.py:108: in raise_if_not_authorized\n    if token != os.environ[TONY_API_KEY_NAME]:\n<frozen os>:714: in __getitem__\n    ???\nE   KeyError: 'TONY_API_KEY'"}, "teardown": {"duration": 0.0002536709999958475, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_parse_tool_call", "lineno": 81, "outcome": "passed", "keywords": ["test_parse_tool_call", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0002846889999830182, "outcome": "passed"}, "call": {"duration": 0.00028054099999508253, "outcome": "passed"}, "teardown": {"duration": 0.00013649400000304013, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_make_vapi_response", "lineno": 90, "outcome": "passed", "keywords": ["test_make_vapi_response", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.00019374999999399733, "outcome": "passed"}, "call": {"duration": 0.00016703000000006796, "outcome": "passed"}, "teardown": {"duration": 0.0001139409999950658, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_blog_search", "lineno": 104, "outcome": "failed", "keywords": ["test_blog_search", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.00024025700000152028, "outcome": "passed"}, "call": {"duration": 0.0027843309999866506, "outcome": "failed", "crash": {"path": "<frozen os>", "lineno": 714, "message": "KeyError: 'TONY_API_KEY'"}, "traceback": [{"path": "tests/integration/test_tony_server.py", "lineno": 125, "message": "in test_blog_search"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 538, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1144, "message": "in post"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 437, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 825, "message": "in request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 914, "message": "in send"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 942, "message": "in _send_handling_auth"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 979, "message": "in _send_handling_redirects"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py", "lineno": 1014, "message": "in _send_single_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 340, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py", "lineno": 337, "message": "in handle_request"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 290, "message": "in call"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 456, "message": "in result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py", "lineno": 401, "message": "in __get_result"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py", "lineno": 221, "message": "in _call_func"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py", "lineno": 1054, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py", "lineno": 112, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 187, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 165, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 62, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 714, "message": "in __call__"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 734, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 288, "message": "in handle"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 76, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "message": "in wrapped_app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 73, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 301, "message": "in app"}, {"path": "/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 212, "message": "in run_endpoint_function"}, {"path": "blog_server.py", "lineno": 200, "message": "in blog_search_endpoint"}, {"path": "tony_server.py", "lineno": 108, "message": "in raise_if_not_authorized"}, {"path": "<frozen os>", "lineno": 714, "message": "in __getitem__"}], "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '131', 'content-type': 'application/json'}\nf\"Error in blog_search: {str(e)}\": Error in blog_search: 'TONY_API_KEY'\n", "longrepr": "tests/integration/test_tony_server.py:125: in test_blog_search\n    response = client.post(\"/blog_search\", json=params, headers=auth_headers)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:538: in post\n    return super().post(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1144: in post\n    return self.request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:437: in request\n    return super().request(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request\n    response = transport.handle_request(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:340: in handle_request\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/testclient.py:337: in handle_request\n    portal.call(self.app, scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/anyio/from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/applications.py:112: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:187: in __call__\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:165: in __call__\n    await self.app(scope, receive, _send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:714: in __call__\n    await self.middleware_stack(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:734: in app\n    await route.handle(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:288: in handle\n    await self.app(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:76: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/starlette/routing.py:73: in app\n    response = await f(request)\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:301: in app\n    raw_response = await run_endpoint_function(\n/opt/hostedtoolcache/Python/3.12.9/x64/lib/python3.12/site-packages/fastapi/routing.py:212: in run_endpoint_function\n    return await dependant.call(**values)\nblog_server.py:200: in blog_search_endpoint\n    raise_if_not_authorized(headers)\ntony_server.py:108: in raise_if_not_authorized\n    if token != os.environ[TONY_API_KEY_NAME]:\n<frozen os>:714: in __getitem__\n    ???\nE   KeyError: 'TONY_API_KEY'"}, "teardown": {"duration": 0.0002447649999908208, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_vapi_assistant_call_input", "lineno": 150, "outcome": "passed", "keywords": ["test_vapi_assistant_call_input", "usefixtures", "pytestmark", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0008376459999794861, "outcome": "passed"}, "call": {"duration": 0.4844990930000108, "outcome": "passed", "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '603', 'content-type': 'application/json'}\ninput: {'message': {'timestamp': 1736039875874, 'type': 'assistant-request', 'call': {'id': 'xxx-xxx', 'orgId': 'xxx-xxx', 'createdAt': '2025-01-05T01:17:55.739Z', 'updatedAt': '2025-01-05T01:17:55.739Z', 'type': 'inbound Phone Call', 'status': 'ringing', 'phoneCallProvider': 'twilio', 'phoneCallProviderId': 'xxx-xxx', 'phoneCallTransport': 'pstn', 'phoneNumberId': 'xxx-xxx', 'assistantId': None, 'squadId': None, 'customer': {'number': '+1xxx-xxx', 'phoneNumber': {'id': 'xxx-xxx', 'orgId': 'xxx-xxx', 'assistantId': None, 'number': '+1xxx-xxx', 'createdAt': '2024-04-12T16:35:14.400Z', 'updatedAt': '2024-11-27T17:14:08.833Z', 'provider': 'twilio'}}}}}\nlen(tony): 1\n"}, "teardown": {"duration": 0.00020626299999548792, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_vapi_assistant_call_input_non_igor", "lineno": 216, "outcome": "passed", "keywords": ["test_vapi_assistant_call_input_non_igor", "usefixtures", "pytestmark", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.00041914799999176466, "outcome": "passed"}, "call": {"duration": 0.06973119299999553, "outcome": "passed", "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '606', 'content-type': 'application/json'}\ninput: {'message': {'timestamp': 1736039875874, 'type': 'assistant-request', 'call': {'id': 'xxx-xxx', 'orgId': 'xxx-xxx', 'createdAt': '2025-01-05T01:17:55.739Z', 'updatedAt': '2025-01-05T01:17:55.739Z', 'type': 'inbound Phone Call', 'status': 'ringing', 'phoneCallProvider': 'twilio', 'phoneCallProviderId': 'xxx-xxx', 'phoneCallTransport': 'pstn', 'phoneNumberId': 'xxx-xxx', 'assistantId': None, 'squadId': None, 'customer': {'number': '+11234567890', 'phoneNumber': {'id': 'xxx-xxx', 'orgId': 'xxx-xxx', 'assistantId': None, 'number': '+1xxx-xxx', 'createdAt': '2024-04-12T16:35:14.400Z', 'updatedAt': '2024-11-27T17:14:08.833Z', 'provider': 'twilio'}}}}}\nlen(tony): 1\n"}, "teardown": {"duration": 0.00019157600002017716, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_is_igor_caller", "lineno": 282, "outcome": "passed", "keywords": ["test_is_igor_caller", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0001795630000174242, "outcome": "passed"}, "call": {"duration": 0.0008852440000168826, "outcome": "passed", "stdout": "Missing 'call' key\n"}, "teardown": {"duration": 0.00011644700001056663, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_get_caller_number", "lineno": 297, "outcome": "passed", "keywords": ["test_get_caller_number", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.00017135800001710777, "outcome": "passed"}, "call": {"duration": 0.0010685249999937696, "outcome": "passed", "stdout": "Missing 'number' key\nMissing 'customer' key\nMissing 'call' key\nMissing 'message' key\nMissing 'message' key\nInput is None\n"}, "teardown": {"duration": 0.00012582399997995708, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_apply_caller_restrictions", "lineno": 327, "outcome": "passed", "keywords": ["test_apply_caller_restrictions", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.00019091400000093017, "outcome": "passed"}, "call": {"duration": 0.00028838599999403414, "outcome": "passed"}, "teardown": {"duration": 0.00011283000000616994, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_assistant_endpoint_logs_failure", "lineno": 376, "outcome": "passed", "keywords": ["test_assistant_endpoint_logs_failure", "usefixtures", "pytestmark", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.00039747900001430025, "outcome": "passed"}, "call": {"duration": 0.04100069700001541, "outcome": "passed", "stdout": "dict(request.headers): {'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflate, zstd', 'connection': 'keep-alive', 'user-agent': 'testclient', 'x-vapi-secret': 'test_secret', 'content-length': '398', 'content-type': 'application/json'}\ninput: {'message': {'timestamp': 1737157773126, 'type': 'status-update', 'status': 'ended', 'endedReason': 'assistant-request-returned-invalid-assistant', 'inboundPhoneCallDebuggingArtifacts': {'error': \"Couldn't Get Assistant...\", 'assistantRequestError': 'Invalid Assistant. Errors: [\\n  \"assistant.model.All fallbackModels\\'s elements must be unique\"\\n]', 'assistantRequestResponse': {'assistant': {'name': 'Tony'}}}}}\nfailure_reason: Invalid Assistant. Errors: [\n                  \"assistant.model.All fallbackModels's elements must be unique\"\n                ]\nMissing 'call' key\nMissing 'call' key\nlen(tony): 1\n"}, "teardown": {"duration": 0.00017201000000000022, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_send_text_integration", "lineno": 415, "outcome": "failed", "keywords": ["test_send_text_integration", "asyncio", "pytestmark", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0005511740000088139, "outcome": "passed"}, "call": {"duration": 0.0004982849999919381, "outcome": "failed", "crash": {"path": "/home/runner/work/tony_tesla/tony_tesla/tony_server.py", "lineno": 449, "message": "ModuleNotFoundError: No module named 'twilio'"}, "traceback": [{"path": "tests/integration/test_tony_server.py", "lineno": 442, "message": "in test_send_text_integration"}, {"path": "tony_server.py", "lineno": 449, "message": "in send_text_endpoint"}], "longrepr": "tests/integration/test_tony_server.py:442: in test_send_text_integration\n    response = await send_text_endpoint(params, headers)\ntony_server.py:449: in send_text_endpoint\n    from twilio.rest import Client\nE   ModuleNotFoundError: No module named 'twilio'"}, "teardown": {"duration": 0.00034511000001202774, "outcome": "passed"}}, {"nodeid": "tests/integration/test_tony_server.py::test_send_text_ifttt_integration", "lineno": 485, "outcome": "failed", "keywords": ["test_send_text_ifttt_integration", "asyncio", "pytestmark", "test_tony_server.py", "integration", "tests", "tony_tesla", ""], "setup": {"duration": 0.0004539829999998801, "outcome": "passed"}, "call": {"duration": 0.0005291519999843786, "outcome": "failed", "crash": {"path": "<frozen os>", "lineno": 714, "message": "KeyError: 'TONY_API_KEY'"}, "traceback": [{"path": "tests/integration/test_tony_server.py", "lineno": 520, "message": "in test_send_text_ifttt_integration"}, {"path": "tony_server.py", "lineno": 511, "message": "in send_text_ifttt_endpoint"}, {"path": "tony_server.py", "lineno": 108, "message": "in raise_if_not_authorized"}, {"path": "<frozen os>", "lineno": 714, "message": "in __getitem__"}], "longrepr": "tests/integration/test_tony_server.py:520: in test_send_text_ifttt_integration\n    response = await send_text_ifttt_endpoint(params, headers)\ntony_server.py:511: in send_text_ifttt_endpoint\n    raise_if_not_authorized(headers)\ntony_server.py:108: in raise_if_not_authorized\n    if token != os.environ[TONY_API_KEY_NAME]:\n<frozen os>:714: in __getitem__\n    ???\nE   KeyError: 'TONY_API_KEY'"}, "teardown": {"duration": 0.0003895440000007966, "outcome": "passed"}}]}